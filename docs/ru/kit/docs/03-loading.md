---
title: Загрузка данных
---

Компонент, определяющий страницу или макет, может экспортировать функцию `load`, которая запускается до создания компонента. Эта функция выполняется как во время рендеринга на стороне сервера, так и в клиенте и позволяет извлекать данные и манипулировать ими до рендеринга страницы, что позволяет обойтись без индикаторов загрузки на странице.

Если данные для страницы поступают от её эндпоинта, функция `load` не понадобится. Она полезна, когда требуется большая гибкость, например, загрузка данных из внешнего API.

```ts
// Декларация типа для `load` (декларации с ключевым 
// словом `export` могут быть импортированы из `@sveltejs/kit`)

export interface Load<Params = Record<string, string>, Props = Record<string, any>> {
 	(input: LoadInput<Params>): MaybePromise<Either<Fallthrough, LoadOutput<Props>>>;
}

export interface LoadInput<Params extends Record<string, string> = Record<string, string>> {
 	url: URL;
 	params: Params;
	props: Record<string, any>;
 	fetch(info: RequestInfo, init?: RequestInit): Promise<Response>;
 	session: App.Session;
 	stuff: Partial<App.Stuff>;
 }

export interface LoadOutput<Props extends Record<string, any> = Record<string, any>> {
 	status?: number;
 	error?: string | Error;
 	redirect?: string;
 	props?: Props;
 	stuff?: Partial<App.Stuff>;
 	maxage?: number;
 }

type MaybePromise<T> = T | Promise<T>;

interface Fallthrough {
	fallthrough: true;
}
```

> Для получения информации об `App.Locals` и `App.Platform` смотрите раздел [TypeScript](#typescript).

Страница, которая загружает данные с внешнего API, может выглядеть так:

```html
<script context="module">
	/** @type {import('@sveltejs/kit').Load} */
	export async function load({ params, fetch, session, stuff }) {
		const response = await fetch(`https://cms.example.com/article/${params.slug}.json`);

		return {
			status: response.status,
 			props: {
 				article: response.ok && (await response.json())
 			}
		};
	}
</script>
```

> Обратите внимание на `<script context="module">` — это необходимо, потому что `load` выполняется до визуализации компонента. Код для каждого экземпляра компонента должен быть размещен во втором теге `<script>`.

`load` в SvelteKit является эквивалентом функциям `getStaticProps` или `getServerSideProps` в Next.js или `asyncData` в Nuxt.js, за исключением того, что она работает как на сервере, так и на клиенте. В приведенном выше примере, если пользователь нажимает на ссылку на эту страницу, данные будут загуржены с `cms.example.com`, не проходя через наш сервер.

Если функция `load` возвращает `{fallthrough: true}`, SvelteKit будет [перебирать маршруты](#marshruty-rasshirennaya-marshrutizacziya-perebor-marshrutov) дальше пока один из них что-то не вернёт, или вернёт ответ с кодом 404.

Функция `load` получает в аргументах метод `fetch`, который имеет следующие специальные свойства:
- имеет доступ к файлам cookie на сервере
- может делать запросы к собственным эндпоинтам приложения без выполнения HTTP-запроса
- при использовании делает копию ответа и встраивает её в страницу при первом запросе для гидрации

`load` может применяться только в компонентах [страниц](#marshruty-straniczy) и [макетов](#makety) (но не в компонентах, которые они импортируют) и по умолчанию работает как на сервере, так и в браузере.

> Код, который вызывается внутри функции `load`:
>
> - должен использовать только свой метод [`fetch`](#zagruzka-dannyh-poluchaemye-znacheniya-fetch), а не нативный `fetch`
> - не должен ссылаться на `window`, `document` или любые другие объекты, специфичные для браузера
> - не должен содержать каких-либо ключей для API или иных секретов, которые будут доступны клиенту, а вместо этого вызывать эндпоинт, который использует любые необходимые секреты

> Мутирование любого общего состояния на сервере повлияет на всех клиентов, а не только на текущего.


### Получаемые значения

Функция `load` получает объект, содержащий шесть полей — `url`, `params`, `props`, `fetch`, `session` и `stuff`. Функция `load` является реактивной и будет повторно запущена при изменении значений её параметров, но только в том случае, если они используются в теле функции. В частности, если в функции используются `url`, `session` или `stuff`, она будут повторно запущена всякий раз, когда их значения изменятся. Также это произойдет при изменении любых отдельных свойств объекта `params`.

> Обратите внимание, что деструктурирование параметров в объявлении функции уже означает их использование в функции.

#### url

`url` - это экземпляр [`URL`](https://developer.mozilla.org/ru-RU/docs/Web/API/URL), содержащий такие свойства, как `origin`, `hostname`, `pathname` и `searchParams`.

> В некоторых средах этот параметр получается из заголовков запроса во время рендеринга на стороне сервера.Если вы используете [adapter-node](/docs#adaptery-podderzhivaemye-platformy-node-js), например, вам может потребоваться настроить адаптер, чтобы URL был правильным.

#### params

`params` получается из `url.pathname` и имени файла маршрута.

Например, для имени файла маршрута  `src/routes/a/[b]/[...c]` и значении `url.pathname` равным `/a/x/y/z`, объект `params` будет выглядеть следующим образом:

```js
{
	"b": "x",
	"c": "y/z"
}
 ```

#### props

Если страница, которую вы загружаете, имеет эндпоинт, то возвращаемые из него данные для свойств страницы доступны внутри  функции `load` как объект `props`. Для компонентов макета и страниц без эндпоинтов `props` будет пустым объектом.

#### fetch

Функция `fetch` является эквивалентом нативной функции `fetch` из Web API, которая может совершать запросы содержащие данные сессии. Она может использоваться как на клиенте так и на сервере.

> Когда функция `fetch` запускается на сервере, полученный результат будет сериализован и размещён в HTML-разметке. Что позволяет функции `load` на клиенте получить идентичные данные моментально без лишнего сетевого запроса.

> Cookie будут переданы только в том случае, если целевой хост совпадает с хостом текущего приложения SvelteKit или его поддоменом.

#### session

`session` может использоваться для передачи данных от сервера в текущий запрос, например идентификатор авторизованного пользователя. По умолчанию значение равно `undefined`. См. [`getSession`](#huki-getsession) в разделе [`Хуки`](#huki), чтобы узнать как использовать этот объект.

#### stuff

Объект `stuff` передаётся из макетов дочерним макетам и страницам, и может содержать то, что нужно сделать доступным ниже. Для корневого компонента `__layout.svelte` он будет равен `{}`, но если функция `load` этого компонента возвращает объект со свойством `stuff`, оно будет доступно для всех функций `load` из дочерних компонентов.

### Возвращаемые значения

Если из `load` возвращается промис, страница не будет отображаться, пока промис не исполнится. У возвращаемого объекта может быть несколько свойств, все они опциональны:

#### status

Код ответа HTTP сервера. Если возвращается `error` – он должен быть из диапазонов `4xx` или `5xx`; при возвращении свойства `redirect` код нужно установить в диапазон `3xx`. По умолчанию код ответа равен `200`.

#### error

Если при выполнении функции `load` что-то пошло не так, поместите в это свойство объект `Error` или просто строку, описывающую проблему, не забыв указать код ответа в свойстве `status` равным числу в диапазонах `4xx` или `5xx`.

#### redirect

Если страница должна перенаправить пользователя на другую страницу (например, эта страница устарела, или пользователь должен сначала авторизоваться или ещё что-то), поместите в это свойство строку, содержащую путь по которому нужно переместить пользователя. Не забудьте указать код ответа в свойстве `status` равным числу в диапазоне `3xx`.

Строка `redirect` должна быть [правильно закодированным URI](https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding). Допустимы как абсолютные, так и относительные URI.

#### maxage

Чтобы страница была закеширована на клиенте, верните в этом свойстве число, равное количеству секунд, сколько страница должна находиться в кеше. Если при отображении страницы использовались какие-либо пользовательские данные (либо через `session`, либо через запрос `fetch` в функции `load`), результирующий заголовок будет включать `private`,  в противном случае там будет `public`, который позволит кешировать страницу различным CDN сервисам.

Это свойство может быть использовано только для страниц, но _не_ для макетов.

#### props

Если функция `load` возвращает объект `props`, то он будет передан компоненту как его свойства, когда он будет отрисован.

#### stuff

Поля из этого объекта будут добавлены к существующим полям объекта `stuff`, который будет предан в функции `load` всех дочерних компонентов страниц и макетов.

Полный объект `stuff` можно использовать в компонентах используя `$page.stuff` из [хранилища страницы](#moduli-$app-stores). Таким образом для страниц обеспечивается механизм передачи данных "вверх", в макеты.