---
title: Загрузка данных
---

Компонент, определяющий страницу или макет, может экспортировать функцию `load`, которая запускается до создания компонента. Эта функция выполняется как во время рендеринга на стороне сервера, так и в клиенте и позволяет извлекать данные и манипулировать ими до рендеринга страницы, что позволяет обойтись без индикаторов загрузки на странице.

Функция `load` может не понадобиться, если данные для страницы поставляются с её эндпоинта. Это полезно, когда нужно больше гибкости, например, для загрузки данных с внешнего API, которая может выглядеть так:

```html
/// file: src/routes/blog/[slug].svelte
<script context="module">
	/** @type {import('./__types/[slug]').Load} */
	export async function load({ params, fetch, session, stuff }) {
		const url = `https://cms.example.com/article/${params.slug}.json`;
 		const response = await fetch(url);

		return {
			status: response.status,
 			props: {
 				article: response.ok && (await response.json())
 			}
		};
	}
</script>
```

> Обратите внимание на `<script context="module">` — это необходимо, потому что `load` выполняется до визуализации компонента. Код для каждого экземпляра компонента должен быть размещен во втором теге `<script>`.

Как и в случае с [эндпоинтами](/docs#marshruty-endpointy), страницы могут импортировать [сгенерированные типы](/docs/types#generated) - `./[slug]` в приведенном выше примере - чтобы убедиться, что `params` правильно набраны.

`load` в SvelteKit является эквивалентом функциям `getStaticProps` или `getServerSideProps` в Next.js или `asyncData` в Nuxt.js, за исключением того, что она работает как на сервере, так и на клиенте. В приведенном выше примере, если пользователь нажимает на ссылку на эту страницу, данные будут загуржены с `cms.example.com`, не проходя через наш сервер.

Функция `load` получает в аргументах метод `fetch`, который имеет следующие специальные свойства:
- имеет доступ к файлам cookie на сервере
- может делать запросы к собственным эндпоинтам приложения без выполнения HTTP-запроса
- при использовании делает копию ответа и встраивает её в страницу при первом запросе для гидратации

`load` может применяться только в компонентах [страниц](#marshruty-straniczy) и [макетов](#makety) (но не в компонентах, которые они импортируют) и по умолчанию работает как на сервере, так и в браузере.

> Код, который вызывается внутри функции `load`:
>
> - должен использовать только свой метод [`fetch`](#zagruzka-dannyh-poluchaemye-znacheniya-fetch), а не нативный `fetch`
> - не должен ссылаться на `window`, `document` или любые другие объекты, специфичные для браузера
> - не должен содержать каких-либо ключей для API или иных секретов, которые будут доступны клиенту, а вместо этого вызывать эндпоинт, который использует любые необходимые секреты

Рекомендуется не хранить состояние каждого запроса в глобальных переменных, а вместо этого использовать их только для межсекторальных проблем, таких как кэширование и хранение подключений к базе данных.

> Мутирование любого общего состояния на сервере повлияет на всех клиентов, а не только на текущего.


### Получаемые значения

Функция `load` получает объект, содержащий 8 полей — `url`, `params`, `props`, `fetch`, `session`, `stuff`, `status`, и `error`. Функция `load` является реактивной и будет повторно запущена при изменении значений её параметров, но только в том случае, если они используются в теле функции. В частности, если в функции используются `url`, `session` или `stuff`, она будут повторно запущена всякий раз, когда их значения изменятся. Также это произойдет при изменении любых отдельных свойств объекта `params`.

> Обратите внимание, что деструктурирование параметров в объявлении функции уже означает их использование в функции.

#### url

`url` - это экземпляр [`URL`](https://developer.mozilla.org/ru-RU/docs/Web/API/URL), содержащий такие свойства, как `origin`, `hostname`, `pathname` и `searchParams` (который содержит разобранную строку запроса в виде объекта [`URLSearchParams`](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams)). `url.hash` недоступен во время `load`, так как он недоступен на сервере.

> В некоторых средах этот параметр получается из заголовков запроса во время рендеринга на стороне сервера.Если вы используете [adapter-node](/docs#adaptery-podderzhivaemye-platformy-node-js), например, вам может потребоваться настроить адаптер, чтобы URL был правильным.

#### params

`params` получается из `url.pathname` и имени файла маршрута.

Например, для имени файла маршрута  `src/routes/a/[b]/[...c]` и значении `url.pathname` равным `/a/x/y/z`, объект `params` будет выглядеть следующим образом:

```json
{
	"b": "x",
	"c": "y/z"
}
 ```

#### props

Если страница, которую вы загружаете, имеет эндпоинт, то возвращаемые из него данные для свойств страницы доступны внутри  функции `load` как объект `props`. Для компонентов макета и страниц без эндпоинтов `props` будет пустым объектом.

#### fetch

Функция `fetch` является эквивалентом нативной функции `fetch` из Web API, которая может совершать запросы содержащие данные сессии. Она может использоваться как на клиенте так и на сервере.

> Когда функция `fetch` запускается на сервере, полученный результат будет сериализован и размещён в HTML-разметке. Что позволяет функции `load` на клиенте получить идентичные данные моментально без лишнего сетевого запроса.

> Cookie будут переданы только в том случае, если целевой хост совпадает с хостом текущего приложения SvelteKit или его поддоменом.

#### session

`session` может использоваться для передачи данных от сервера в текущий запрос, например идентификатор авторизованного пользователя. По умолчанию значение равно `undefined`. См. [`getSession`](#huki-getsession) в разделе [`Хуки`](#huki), чтобы узнать как использовать этот объект.

#### stuff

Объект `stuff` передаётся из макетов дочерним макетам и страницам, и может содержать то, что нужно сделать доступным ниже. Для корневого компонента `__layout.svelte` он будет равен `{}`, но если функция `load` этого компонента возвращает объект со свойством `stuff`, оно будет доступно для всех функций `load` из дочерних компонентов.

#### status

`status` - это код состояния HTTP при отображении страницы ошибки или `null` в противном случае.

#### error

`error` - это ошибка, которая была выдана (или возвращена из предыдущей `load`) при отображении страницы ошибки или `null` в противном случае.


### Возвращаемые значения

Если из `load` возвращается промис, страница не будет отображаться, пока промис не исполнится. У возвращаемого объекта может быть несколько свойств, все они опциональны:

> `status`, `error`, `redirect` и `cache` игнорируются при отображении страниц ошибок.

#### status

Код ответа HTTP сервера. Если возвращается `error` – он должен быть из диапазонов `4xx` или `5xx`; при возвращении свойства `redirect` код нужно установить в диапазон `3xx`. По умолчанию код ответа равен `200`.

#### error

Если при выполнении функции `load` что-то пошло не так, поместите в это свойство объект `Error` или просто строку, описывающую проблему, не забыв указать код ответа в свойстве `status` равным числу в диапазонах `4xx` или `5xx`.

#### redirect

Если страница должна перенаправить пользователя на другую страницу (например, эта страница устарела, или пользователь должен сначала авторизоваться или ещё что-то), поместите в это свойство строку, содержащую путь по которому нужно переместить пользователя. Не забудьте указать код ответа в свойстве `status` равным числу в диапазоне `3xx`.

Строка `redirect` должна быть [правильно закодированным URI](https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding). Допустимы как абсолютные, так и относительные URI.

#### cache

```json
cache: {
	"maxage": 300,
	"private": false
}
```

Чтобы кэшировать страницы, верните объект `cache`, содержащий свойство `maxage`, установленное в `number`, описывающий максимальный возраст страницы в секундах. При необходимости также включите свойство `boolean` `private`, указывающее, должен ли результирующий заголовок `Cache-Control` быть `private` или `public` (это означает, что он может быть кэширован CDN в дополнение к отдельным браузерам).

> Если `cache.private` является `undefined`, SvelteKit установит его автоматически, используя следующую эвристику: если функция `load` делает `fetch` учетных данных или страница использует `session`, она считается частной.

Это свойство может быть использовано только для страниц, но _не_ для макетов.

#### props

Если функция `load` возвращает объект `props`, то он будет передан компоненту как его свойства, когда он будет отрисован.

#### stuff

Поля из этого объекта будут добавлены к существующим полям объекта `stuff`, который будет предан в функции `load` всех дочерних компонентов страниц и макетов.

Полный объект `stuff` можно использовать в компонентах используя `$page.stuff` из [хранилища страницы](#moduli-$app-stores). Таким образом для страниц обеспечивается механизм передачи данных "вверх", в макеты.

#### dependencies

Массив строк, представляющих URL-адреса, от которых зависит страница, которые впоследствии могут быть использованы с [`invalidate`](#moduli-$app-navigation), чтобы вызвать повторный запуск `load`. Вам нужно добавить их в `зависимости`, только если вы используете пользовательский API-клиент; URL-адреса, загруженные с предоставленной функцией `fetch`, добавляются автоматически.

URL-адреса могут быть абсолютными или относительно загружаемой страницы и должны быть [закодированы] (https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding).